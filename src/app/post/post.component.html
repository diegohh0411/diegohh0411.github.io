<div
class="bg-gray-100
m-4 p-4 rounded-2xl
flex flex-col gap-3
max-w-3xl md:mx-auto
">
  <h1 class="text-6xl">
    {{postMapping.title}}
  </h1>

  <p>
    Publicado el {{(postMapping.publishDateISO8601).toLocaleDateString('es-MX')}}
  </p>

  <div class="flex flex-row gap-3">
      <div *ngFor="let tag of postMapping.tags"
      class="px-4 py-1
      bg-gray-200 hover:bg-gray-300 active:bg-gray-400
      rounded-2xl
      cursor-pointer"

      [routerLink]="['/archive']"
      [queryParams]="{ tag: tag }"
      >
        #{{tag}}
      </div>
    </div>
</div>


<div class="mx-4
max-w-3xl md:mx-auto
text-justify">
  <markdown class="markdown">
    {{postMapping.content}}
  </markdown>
</div>

<div *ngIf="!hintIsHidden && this.postMapping.imageFilenames.length !== 0"
class="
bg-blue-100 rounded-2xl
m-4 p-4
flex items-center gap-4
max-w-3xl md:mx-auto
">
  <p>
    Puedes hacer clic en cualquier imagen para abrirla en pantalla completa.
  </p>

  <svg
  (click)="hideHint()"
  xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
   class="w-12 h-12
   md:w-8 md:h-8
   cursor-pointer">
    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
  </svg>
</div>

<div class="flex flex-col
gap-[50vh]
pt-6 pb-[50vh]
px-4
relative
"
id="imageContainer"
>
  <img *ngFor="let image of postMapping.imageFilenames"
  [src]="'assets/' + image + (md ? '_full.jpg' : '_800.jpg')"
  class="w-1/2 md:w-1/6
  object-contain max-h-[80vh]
  cursor-pointer
  sticky
  transition-all ease-in-out duration-[5000ms]
  shadow-2xl
  "

  [alt]="'Fotografía de Diego Hernández del álbum ' + postMapping.title + '.'"

  [style.left]="math.random() * (md ? 80 : 50) + '%'"
  [style.top]="math.random() * 20 +  20 + 'vh'"

  (click)="toggleOverlay(image)"
  />
</div>

<div *ngIf="overlayIsOpen"
class="
fixed inset-0 p-4
z-30
bg-white
flex flex-col items-center justify-between
"
>
  <div class="flex justify-end w-full">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
         class="w-8 h-8 cursor-pointer"
         (click)="toggleOverlay('')"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
    </svg>
  </div>

  <div
  class="flex flex-col gap-3"
  >
    <div class="flex flex-row items-center justify-between">
      <p>Foto no. {{currentIndex + 1}}/{{this.postMapping.imageFilenames.length}}</p>

      <a [href]="'assets/' + overlayedImage + '_full.jpg'" [download]="overlayedImage + '_full.jpg'">
        <p
          class="px-4 py-1 bg-blue-100 rounded-2xl cursor-pointer"
        >
          Descargar
        </p>
      </a>
    </div>


    <img
    [defaultImage]="'assets/' + overlayedImage + '_800.jpg'"
    [lazyLoad]="'assets/' + overlayedImage + '_full.jpg'"

    class="max-h-[75vh]
    shadow-2xl"

    [id]="overlayedImage + '_overlayedImage'"
    [alt]="'Fotografía de Diego Hernández del álbum ' + postMapping.title + '.'"
   />
  </div>

  <div
  class="flex flex-row items-center justify-between"
  >
    <div class="rounded-l-2xl
    bg-gray-200
    py-2 px-4 cursor-pointer"
    [ngClass]="[
      newIndex('prev') < 0
      ?
      'opacity-40'
      :
      'hover:bg-gray-300 active:bg-gray-400'
    ]"
    (click)="changeImage('prev')"
    >
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
           class="w-8 h-8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
      </svg>
    </div>

    <div class="rounded-r-2xl
    bg-gray-200
    py-2 px-4 cursor-pointer"
    [ngClass]="[
      newIndex('next') > this.postMapping.imageFilenames.length - 1
      ?
      'opacity-40'
      :
      'hover:bg-gray-300 active:bg-gray-400'
    ]"
    (click)="changeImage('next')"
    >
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
           class="w-8 h-8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
      </svg>
    </div>
  </div>
</div>
